พัฒนานอสเตอร์รีเลย์ที่ปฏิบัติตามข้อกำหนดของนอสเตอร์โปรโตคอลสำหรับการสื่อสาร
DEVELOPMENT OF THE NOSTR RELAY THAT ADHERES TO THE SPECIFICATIONS OF THE NOSTR PROTOCOL FOR DATA COMMUNICATION

วัชรพล พงษ์วิลัย

โครงงานสหกิจศึกษานี้เป็นส่วนหนึ่งของการศึกษาตามหลักสูตร
ปริญญาวิทยาศาสตรบัณฑิต สาขาวิชาเทคโนโลยีสารสนเทศ
คณะเทคโนโลยีสารสนเทศ
สถาบันเทคโนโลยีไทย-ญี่ปุ่น
พ.ศ. 2567

---

# บทที่ 1

## 1.7 ที่มาและความสำคัญของปัญหา

โซเชียลมีเดียมีบทบาทสำคัญในการสื่อสารและเชื่อมโยงผู้คนทั่วโลก แต่ก็มีปัญหาหลายประการที่ส่งผลกระทบต่อผู้ใช้งานและผู้สร้างเนื้อหาดังนี้:

- **1.7.1 การใช้ความสนใจของผู้ใช้เพื่อทำการขายโฆษณา**  
โซเชียลมีเดียใช้ข้อมูลพฤติกรรมของผู้ใช้เพื่อสร้างรายได้จากการขายโฆษณา


- **1.7.2 การดึงดูดผู้ใช้ให้อยู่กับแพลตฟอร์มนานขึ้น**  
โซเชียลมีเดียออกแบบเนื้อหาและฟังก์ชันเพื่อเพิ่มเวลาที่ผู้ใช้ใช้บนแพลตฟอร์ม โดยใช้อัลกอริธึมที่กระตุ้นให้ผู้ใช้ติดตามเนื้อหาที่สร้างความตื่นเต้นหรือมีการโต้เถียงกัน ซึ่งอาจส่งผลเสียต่อสุขภาพจิต


- **1.7.3 การแสดงเนื้อหาผ่านอัลกอริธึมที่ไม่สามารถตรวจสอบได้**  
ระบบอัลกอริธึมเลือกแสดงเนื้อหาตามความสนใจของผู้ใช้โดยที่ผู้ใช้ไม่สามารถตรวจสอบหรือปรับเปลี่ยนได้


- **1.7.4 การควบคุมการเข้าร่วมและการเซ็นเซอร์เนื้อหา**  
โซเชียลมีเดียควบคุมว่าใครสามารถเข้าร่วมและเนื้อหาประเภทใดควรได้รับการเซ็นเซอร์ ซึ่งจำกัดเสรีภาพในการแสดงความคิดเห็นและการสร้างเนื้อหาของผู้ใช้งาน


- **1.7.5 การละเมิดความเป็นส่วนตัว**  
ข้อมูลส่วนตัวและพฤติกรรมของผู้ใช้ที่ถูกรวบรวมอาจถูกนำไปใช้ในทางที่ไม่เหมาะสม ซึ่งเสี่ยงต่อการละเมิดความเป็นส่วนตัว


- **1.7.6 การเสพติดและการสูญเสียเวลา**  
การออกแบบที่ดึงดูดความสนใจทำให้ผู้ใช้ใช้เวลามากเกินไปกับแพลตฟอร์ม ส่งผลเสียต่อการทำงานและสุขภาพจิต


- **1.7.7 การต้องปรับตัวตามการเปลี่ยนแปลงของอัลกอริธึม**  
ผู้สร้างเนื้อหาต้องปรับตัวตามการเปลี่ยนแปลงของอัลกอริธึมเพื่อให้เนื้อหาถูกแสดงผลต่อผู้ใช้มากที่สุด ทำให้การสร้างเนื้อหามีความท้าทาย


---

## 1.8 วัตถุประสงค์หรือจุดมุ่งหมายของโครงงาน

โครงงานนี้มีวัตถุประสงค์เพื่อพัฒนา Relay ซึ่งเป็นโครงสร้างพื้นฐานสำคัญของ Nostr Protocol ที่ช่วยในการกระจายข้อมูลและการเชื่อมโยงระหว่างผู้ใช้งานและผู้สร้างเนื้อหาผ่านเครือข่ายแบบกระจายศูนย์ โดยใครๆ ก็สามารถรัน
Relay ได้ด้วยตัวเอง ติดตั้งได้ง่าย อีกทั้งยังสามารถกำหนดค่านโยบาย Relay ตามความต้องการ เพื่อเสริมสร้างโซเชียลมีเดียระดับโลกที่แข็งแกร่ง ทนทานต่อการปิดกั้น

---

## 1.9  ผลที่คาดว่าจะได้รับจากการปฏิบัติงานหรือพัฒนาโครงงานนี้

จากการพัฒนา Relay ซึ่งเป็นโครงสร้างพื้นฐานของ Nostr Protocol โครงงานนี้คาดว่าจะมีผลลัพธ์ที่สำคัญหลายประการ เพื่อเสริมสร้างโซเชียลมีเดียระดับโลก ที่ทนทานต่อการปิดกั้น

- **1.9.1 การสนับสนุนการสร้างโครงสร้างพื้นฐานที่กระจายศูนย์** \
การพัฒนา Relay จะช่วยให้ระบบการส่งข้อมูลและการสื่อสารไม่ขึ้นกับแพลตฟอร์มหรือเซิร์ฟเวอร์ใดๆ เพียงแห่งเดียว
ซึ่งช่วยเพิ่มความเป็นอิสระและความมั่นคงให้กับผู้ใช้งาน โดยไม่ต้องพึ่งพาผู้ให้บริการกลางหรือผู้ควบคุมแพลตฟอร์ม


- **1.9.2 เสนอตัวเลือก Relay ที่มีประสิทธิภาพสูงในการใช้งาน** \
Relay ที่พัฒนาขึ้นจะเป็นตัวเลือกหนึ่งที่สามารถนำไปใช้งานได้อย่างมีประสิทธิภาพสูง รองรับการเชื่อมต่อที่รวดเร็วและมั่นคง

---

## 1.10 นิยามศัพท์เฉพาะ

- **1.10.1 NIP (Nostr Implementation Possibilities)** \
ชุดข้อตกลงหรือมาตรฐานที่กำหนดแนวทางการพัฒนาสำหรับการสื่อสารและการแลกเปลี่ยนข้อมูลระหว่าง Client และ Relay เพื่อให้ระบบ Nostr Network สามารถทำงานร่วมกันได้อย่างมีประสิทธิภาพ


- **1.10.2 Event** \
หน่วยข้อมูลใน **Nostr Protocol** ที่ใช้สำหรับส่งข้อความหรือคำสั่งระหว่าง **Client** และ **Relay** มีโครงสร้างเป็น JSON เพื่อให้สามารถแลกเปลี่ยนข้อมูลได้อย่างเป็นระบบและปลอดภัย โครงสร้างของ Event จะประกอบด้วยข้อมูลสำคัญดังนี้:

  - **`id`**  
  ค่าที่ได้จากการเข้ารหัสแบบ SHA-256 ของข้อมูล Event ทั้งหมดในรูปแบบ JSON โดยผลลัพธ์จะเป็นค่ารหัสฐาน 16 (Hexadecimal) ยาว 32 ไบต์ ใช้เพื่อระบุ Event อย่างเฉพาะเจาะจง

  - **`pubkey`**  
  คีย์สาธารณะของผู้สร้าง Event มีความยาว 32 ไบต์ และอยู่ในรูปแบบ Hexadecimal ใช้เพื่อยืนยันตัวตนของผู้สร้าง

  - **`created_at`**  
  เวลาที่ Event ถูกสร้างขึ้นในรูปแบบ UNIX Timestamp

  - **`kind`**  
  ประเภทของ Event แสดงด้วยค่าจำนวนเต็มระหว่าง 0 ถึง 65535 ใช้ในการจำแนกประเภทหรือความหมายของ Event เช่น ข้อความปกติ การแก้ไขโปรไฟล์ หรือคำสั่งพิเศษ

  - **`tags`**  
  ข้อมูลเพิ่มเติมในรูปแบบของอาร์เรย์สองมิติ ประกอบด้วยรายการข้อมูลที่สามารถปรับแต่งได้ เช่น การกำหนดผู้รับ, หมวดหมู่, หรือการอ้างอิงถึง Event อื่น

  - **`content`**  
  เนื้อหาของ Event ซึ่งเป็นข้อความหรือข้อมูลในรูปแบบสตริงที่สามารถกำหนดได้ตามต้องการ

  - **`sig`**  
  ลายเซ็นดิจิทัลที่ได้จากการลงนามข้อมูล Event ด้วย `Schnorr Signature` โดยใช้คีย์ส่วนตัว (Private Key) ของผู้สร้าง Event ผลลัพธ์เป็นค่า Hexadecimal ยาว 64 ไบต์ ใช้เพื่อรับรองความถูกต้องและป้องกันการปลอมแปลง

#### ตัวอย่างโครงสร้าง Event:
```json
  {
    "id": "0000005b0fc51e70b66db99ba1708b1a1b008c30db35d19d35146b3e09756029",
    "pubkey": "161498ed3277aa583c301288de5aafda4f317d2bf1ad0a880198a9dede37a6aa",
    "created_at": 1716617176,
    "kind": 1,
    "tags": [
      ["nonce","19735841","23"]
    ],
    "content": "My custom content",
    "sig": "954c662c9ee29ccad8a1f30d22b9a5cefcea774f72428ec7344b65e4f31fff24fc4dd0b7874a4d10a1a4c012de013df19a7c33018dda5f1207280f9a28193498"
  }
```

- **1.10.3 Relay** \
  เซิร์ฟเวอร์ที่ทำหน้าที่เป็นตัวกลางในการรับและส่ง Event ระหว่าง Client โดย Relay จะนำเนินการตามคำร้องขอของ Client เช่นคำสั่งร้องขอข้อมูล รวมไปถึงคำสั

- **1.10.4 Client** \
  ซอฟต์แวร์หรือแอปพลิเคชันที่ผู้ใช้สามารถโต้ตอบกับระบบ Nostr Protocol ได้โดยตรง Client ทำหน้าที่สร้าง, ส่ง, รับ, และแสดงผลข้อมูล (Events) ที่แลกเปลี่ยนกับ Relay ตัวอย่างเช่น แอปพลิเคชันที่ใช้สำหรับการแชท, การโพสต์ข้อความ, ไลฟ์สตรีม
  โดย Client อาจอยู่ในรูปแบบของเว็บแอปพลิเคชัน โมบายล์แอปพลิเคชัน หรือโปรแกรมเดสก์ท็อป

---

# บทที่ 2

**ทฤษฎีและเทคโนโลยีที่ใช้ในการปฏิบัติงาน**

การพัฒนา Relay มีรากฐานจากแนวคิด Clean Code และเทคโนโลยีที่ช่วยเพิ่มความปลอดภัย เสถียรภาพ และประสิทธิภาพ โดยแต่ละองค์ประกอบส่งเสริมให้ Relay รองรับการสื่อสารแบบกระจายศูนย์ได้อย่างเหมาะสม

---

## **2.1 Cryptography**

- **2.1.1 secp256k1**  \
ใช้งาน secp256k1 ซึ่งเป็นเส้นโค้งวงรี (Elliptic Curve) ที่ใช้ในกระบวนการสร้าง Key Pair สำหรับการเข้ารหัสและตรวจสอบความถูกต้องของข้อมูล

- **2.1.2 Schnorr Signature** \
ใช้ในการตรวจสอบลายเซ็นดิจิทัลแบบเดียวกับที่ Bitcoin ใช้ที่มีขนาดเล็กและปลอดภัย ช่วยเพิ่มความเร็วในการตรวจสอบและป้องกันการปลอมแปลงข้อมูล

---

## **2.2 Clean Code**
เป็นสิ่งสำคัญที่ช่วยให้งานพัฒนาซอฟต์แวร์มีความยั่งยืนและง่ายต่อการดูแลรักษา หลักการพื้นฐานของ Clean Code ได้รับการยอมรับในวงการนักพัฒนามาอย่างยาวนาน และช่วยสร้างมาตรฐานสำหรับโค้ดที่มีคุณภาพ

---

## **2.3 Dependency Injection (DI)**
เป็นเทคนิคที่ช่วยแยกการพึ่งพาของออบเจ็กต์ในแอปพลิเคชันออกจากกัน โดยการนำ dependencies (เช่น บริการหรือคลาสต่างๆ) เข้ามาให้โดยตรงจากภายนอกแทนการสร้างขึ้นเองในคลาสนั้นๆ ทำให้โค้ดมีความยืดหยุ่น สามารถทดสอบและบำรุงรักษาง่ายขึ้น โดยเฉพาะในระบบขนาดใหญ่ที่ต้องจัดการกับหลายๆ บริการหรือคลาสที่พึ่งพากัน

ในโครงงานนี้ DI ใช้เพื่อการจัดการกับ Service ต่างๆ เช่น การเชื่อมต่อฐานข้อมูล NIPs และ Module ต่างๆ ทำให้สามารถปรับแต่งและทดสอบแต่ละส่วนได้สะดวก

---

## **2.4 Proof-of-Work (PoW)**

เป็นกลไกที่ช่วยเพิ่มความปลอดภัยให้กับ Relay โดยลดโอกาสในการเกิดปัญหาสแปมและการโจมตีทางไซเบอร์ เช่น DDoS ผ่านหลักการดังนี้

- **2.4.1 การเพิ่มต้นทุนการสร้าง Event** \
ก่อนที่ Client จะส่ง Event ไปยัง Relay ได้สำเร็จ จะต้องแก้โจทย์ที่เรียกว่า **cryptographic puzzle**โดยใช้พลังงานและเวลาในการคำนวณ Hash ที่ตรงตามเป้าของ Relay กำหนดความยากขั้นต่ำ เป็นการเพิ่มต้นทุนในการสร้าง Event เพื่อป้องกันการส่งข้อมูลที่ไม่พึงประสงค์


- **2.4.2 ป้องกันสแปม:** \
สำหรับการสร้างค่า Hash ที่เข้าเป้าตามที่ Relay กำหนดทำให้การส่ง Event ขยะหรือการหลอกลวงปริมาณมากในระยะเวลาสั้นเป็นเรื่องที่ไม่คุ้มค่า


- **2.4.3 การป้องกันการโจมตี DDoS:**  \
ผู้โจมตีจะต้องใช้ทรัพยากรที่มหาศาลในการสร้าง Event เพื่อโจมตี Relay ช่วยลดโอกาสที่ Relay จะล่มจากการโจมตี

---

## **2.5 เทคโนโลยีที่ใช้ในการปฏิบัติงาน**

- **2.5.1 Kotlin** \
เป็นภาษาโปรแกรมสมัยใหม่ที่พัฒนาโดย JetBrains ซึ่งมีความเรียบง่าย กระชับ และปลอดภัย เหมาะสำหรับการพัฒนาซอฟต์แวร์ในยุคปัจจุบัน
รองรับการเขียนโค้ดที่ช่วยลดข้อผิดพลาด เช่น NullPointerException อีกทั้งมีฟีเจอร์รองรับ Coroutines ซึ่งช่วยให้จัดการงานแบบ Asynchronous ได้ง่ายและมีประสิทธิภาพ อีกทั้งทำงานร่วมกับ Java ได้อย่างไร้รอยต่อ


- **2.5.2 JVM 21** \
การใช้ JVM มีความเสถียรภาพสูง เหมาะสำหรับการทำงานระยะยาว โดยมีการปรับจูนโค้ดตลอดการใช้งาน ทำให้แอพทำงานได้เร็ว มีประสิทธิภาพมากขึ้นเมื่อใช้งานต่อเนื่อง 
อย่างไรก็ตาม การใช้ JVM มีการใช้หน่วยความจำและใช้เวลาการประมวลผลมากในช่วงเริ่มต้น อีกทั้งยังรองรับ Virtual Threads (Project Loom)สำหรับการประมวลผลแบบ Concurrency เพิ่มความเร็วและความเสถียรของแอปพลิเคชัน


- **2.5.3 GraalVM CE 21**\
GraalVM สามารถคอมไพล์โค้ดเป็น Native Binaries ทำให้รันได้ทันทีและใช้หน่วยความจำต่ำ เหมาะสำหรับระบบที่ต้องการการตอบสนองรวดเร็ว แต่ Native Binaries
  อาจมีข้อจำกัดในการทำงานบน CPU ที่แตกต่าง


- **2.5.4 Docker**\
เป็นเครื่องมือที่ช่วยสร้างและจัดการ คอนเทนเนอร์ ซึ่งเป็นสภาพแวดล้อมจำลองสำหรับการรันแอปพลิเคชัน ทำให้สามารถพัฒนาและทดสอบซอฟต์แวร์ได้ในสภาพแวดล้อมที่เหมือนกันทุกครั้ง
โดยรองรับการติดตั้งและรันระบบได้ทันทีในทุกสภาพแวดล้อม ลดเวลาในการเตรียมการและมุ่งเน้นไปที่การพัฒนาโค้ดได้อย่างสะดวก


- **2.5.5 Micronaut Framework** \
Micronaut เป็น Framework ที่ออกแบบมาเพื่อรองรับแอปพลิเคชันขนาดเล็กแต่ประสิทธิภาพสูง ด้วยฟีเจอร์อย่าง Dependency Injection (DI) และการคอมไพล์ล่วงหน้า (AOT Compilation) 
ซึ่งช่วยลดเวลาการประมวลผลและการใช้หน่วยความจำ รองรับ WebSocket และ Micronaut ยังเหมาะกับการพัฒนา Cloud-Native Applications และระบบที่ต้องการเริ่มต้นและตอบสนองได้รวดเร็ว


- **2.5.6 Postgresql** \
PostgreSQL เป็นระบบจัดการฐานข้อมูลเชิงสัมพันธ์ที่มีประสิทธิภาพและความน่าเชื่อถือสูง
รองรับการจัดการข้อมูลปริมาณมากและการทำงานพร้อมกันหลายรายการ


- **2.5.7 HikariCP**
เป็นเครื่องมือสำหรับจัดการ การเชื่อมต่อฐานข้อมูลที่มีประสิทธิภาพสูง ออกแบบมาเพื่อเพิ่มความเร็วและลดต้นทุนค่าใช้จ่ายในการบริหารจัดการการเชื่อมต่อ


- **2.5.8 Git และ GitHub Actions** \
ใช้สำหรับการจัดการซอร์สโค้ด และ GitHub Actions เพื่อสร้าง Workflow อัตโนมัติสำหรับการทดสอบแอปพลิเคชัน ช่วยเพิ่มความมั่นใจในคุณภาพของซอฟต์แวร์


- **2.5.9 Intellij IDEA Ultimate** \
IntelliJ IDEA เป็น IDE ที่ทรงพลังและมีฟีเจอร์ครบครัน อำนวยความสะดวกสำหรับการพัฒนาภาษาทางสาย JVM อย่างเช่น Kotlin, Java, Scala, Groovy


# บทที่ 3

**แผนงานการปฏิบัติงานและขั้นตอนการดำเนินงาน**

## **3.1 แผนการทําโครงงาน**

[//]: # (รวมไปถึงการออกแบบระบบ และดำเนินการพัฒนาทั้งหมดนี้ในช่วงเดือน พฤศจิกายน ถึงเดือน มกราคม)

<img height="260" width="900" src="/thai/img/gantt-chart.png"/>

## **3.2 รายละเอียดแผนงานการทําโครงงาน**
โครงงานนี้ได้ทำการออกแบบ Relay ให้มีความยืดหยุ่นพัฒนาต่อยอดได้ง่ายเพื่อรองรับ NIP ใหม่ๆ ในอนาคต และมีประสิทธิภาพการทำงานสูง 
อีกทั้งต้องพัฒนา Software ให้มีความเข้ากันได้ 100% ระหว่างแพลตฟอร์ม JVM และ GraalVM 

คุณสมบัติ NIPs พื้นฐานของ Relay ที่ต้องรองรับสำหรับรุ่น v1.0 ได้แก่

- **NIP-01 Basic protocol flow**
- **NIP-02 Follow List**
- **NIP-04 Encrypted Direct Message**
- **NIP-09 Event Deletion**
- **NIP-11 Relay Information**
- **NIP-13 Proof of Work**
- **NIP-15 Marketplace**
- **NIP-28 Public Chat**
- **NIP-45 Event Counts**
- **NIP-50 Search Capability**


## **3.3 ขั้นตอนการดำเนินโครงงานสร้าง Relay**

- **3.3.1 ศึกษาข้อมูลทำความเข้าใจ Nostr Protocol** \
ทำการศึกษา Nostr Protocol อย่างละเอียดสำหรับสร้าง Relay และอ่านซอสโค้ดทำความเข้าใจ Relay ของคนอื่นๆ จาก implementation ในภาษาโปรแกรมต่างๆ


- **3.3.2 ออกแบบระบบและวางโครงสร้าง Software** \
ออกแบบโครงสร้างของระบบและการไหลของข้อมูล โดยให้ความสำคัญกับการเขียนโค้ดที่มีความเป็นระเบียบและอ่านง่าย การออกแบบต้องคำนึงถึงความยืดหยุ่นและความสามารถในการปรับเปลี่ยนเทคโนโลยีในอนาคต การสร้าง API ที่สามารถเรียกใช้เทคโนโลยีต่าง ๆ และรองรับการเพิ่ม NIP ใหม่ ๆ ในอนาคตได้อย่างง่ายดายผ่านระบบ Plug-in



- **3.3.3 ดำเนินการเขียนโค้ด**  \
เริ่มเขียนโค้ดตามโครงสร้างที่ออกแบบไว้ เพื่อรองรับการเชื่อมต่อกับ NIP และโมดูลต่าง ๆ ที่จะนำมารวมกัน เน้นการเขียนโค้ดที่สะอาด (Clean Code) เพื่อให้เข้าใจง่ายและบำรุงรักษาง่าย เมื่อพัฒนา NIP หรือโมดูลใดเสร็จแล้ว จะทำการทดสอบ Unit Test ฟังก์ชันต่าง ๆ รวมถึงระบบที่เกี่ยวข้อง หลังจากระบบทำงานได้ตามที่ต้องการแล้ว จะทำการเพิ่มประสิทธิภาพโค้ดและทดสอบใหม่อีกครั้ง เมื่อผลที่ได้เป็นที่น่าพอใจก็จะเขียนคอมเม้นอธิบาย




